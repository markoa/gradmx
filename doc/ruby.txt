Programski jezik Ruby
=====================

Za razumevanje Rails frameworka i praćenja koda koji je izložen u ovom radu potrebno je poznavati Ruby, programski jezik u kome je napisan. Pošto na srpskom jeziku postoji vrlo malo literature o njemu, u ovom poglavlju će biti izložen pregled osnovnih, a potom i neki od naprednijih elemenata jezika koji su osnova Rails frameworka.

Ruby je dinamički interpretirani programski jezik. Inspirisan je jezicima Lisp, Smalltalk i Perl, ali mu je gramatika lako razumljiva C i Java programerima. Ruby je potpuno objektno orijentisani jezik, ali je takođe prigodan i za proceduralni i funkcionalni stil programiranja. Pruža mogućnosti metaprogramiranja koje mogu da se koriste u svrhu stvaranja jezika specifičnog domena (domain-specific languages, DSL).

Objektna orijentisanost
-----------------------

U Ruby-ju, svaka vrednost je objekat, čak i prosti numerički simboli i vrednosti true, false i nil (nil je Ruby varijanta null - posebna vrednost koja označava odsustvo vrednosti). U primerima koji to demonstriraju pozivamo metodu po imenu class. Komentari u Ruby-ju počinju sa #.

  1.class      # => Fixnum
  0.0.class    # => Float
  true.class   # => TrueClass: true je singlton instanca od TrueClass
  false.class  # => FalseClass
  nil.class    # => NilClass

Koriščenje zagrada prilikom pozivanja funkcija i metoda nije neophodno. U Ruby-ju su zagrade obično opcione i često se ni ne pišu, naročito kada se pozvanoj metodi ne prosleđuje nijedan parametar. Posledica toga je da poziv metode liči na referenciranje imenovanog polja ili promenljive objekta. To nije slučajno, međutim Ruby striktno vodi računa o enkapsulaciji; pristup unutrašnjem stanju objekta spolja nije dozvoljen. Svakom takvom pristupu mora posredovati pristupna metoda, kao što je metoda class u primeru iznad.

Kontrola toka
-------------

Ruby sadrži uobičajene kontrole toka, kao što su naredba if ili while petlja. Razlikuje se od jezika iz C familije po tome što se ne koriste vitičaste zagrade oko tela ovih naredbi, već kraj tela označava ključna reč end:

if count > 10
  puts "Pokušajte ponovo"
elsif count == 3
  puts "Trojka"
else
  puts "Unesite broj"
end

while weight < 400 and people_count <= 10
  person = next_person()
  weight += person.weight
  people_count += 1
end

Modifikatori naredbi su korisni kada je telo naredbe ili petlje samo jedan izraz:

puts "Paran broj broj" unless x%2 == 1
distance = distance * 1.2 while distance < 100

Blokovi i iteratori
-------------------

Petlje se često pišu pomoću posebnih metoda koje se nazivaju iteratori.

3.times { puts "gradmx" }   # ispis će se ponoviti tri puta
[1, 2, 3].each { |i| puts } # ispis svakog od elementa niza
selected = [1, 2, 3, 4].select { |i| i%2 == 0 } # izdvoj elemente deljive sa 2
selected.inject do |sum, i| # izračunaj sumu elemenata => 6
  sum + x
end

times, each, select i inject su iteratori koji interakuju sa blokovima koda koji dolaze posle njih. Kontrola toka koja stoji iza ovoga je yield, naredba koja privremeno prebacuje kontrolu izvršavanja sa iteratora na blok koda koji je vezan za poziv iteratora. Kada dođe do kraja koda u bloku, metoda iteratora preuzima kontrolu i nastavlja sa izvršenjem od prve linije posle yield. Česta konvencija je da se jednolinijski blokovi pišu sa vitičastim zagradama, a blokovi sa više linija koda sa do/end.

Povezivanje bloka koda sa pozivom metode je osnovna i vrlo važna mogućnost Ruby-ja. Ono ne mora biti vezano samo za petlje, npr.:

File.open("data.txt") do |f|
  line = f.readline
end

Heševi i simboli
----------------

Heševi su, kao i nizovi, osnovna struktura podataka u Ruby-ju. Zasnovani su na strukturi podataka heš tabele i služe za mapiranje proizvoljnih ključeva na (takođe proizvoljne) vrednosti.

h = {
  :jedan => 1,
  :dva => 2
}
h[:jedan]                   # => 1
h[:dva]                     # => 2
h[:tri] = 3                 # dodaje nov par u heš
h.each do |key, value|      # ugrađeni iterator each daje ključ i vrednost
  print "#{key}: #{value}"  # primer interpolacije stringova; implicitno je pozvana metoda to_s, koju poseduje svaki objekat
end

Heševi mogu da prime bilo koji objekat kao ključ, međutim za to se, kao u primeru iznad, najčešće koriste simboli. Simboli su nepromenljivi, interno čuvani stringovi.

Heševi se često koriste kao parametri funkcija. U Ruby-ju je pisanje vitičastih zagrada opciono ukoliko je heš poslednji u listi parametara. Rails ovu mogućnost često koristi, a rezultat je intuitivniji i izražajniji kod. U sledećoj liniji se prosleđuje jedan heš funkciji redirect_to. Zbog izostavljanja zagrada utisak je da Rails ima definisane posebne ključne ruči za ovu svrhu.

redirect_to :action => 'show', :id => event.id

Metode
------

Metode se definišu pomoću ključne reči def. Rezultat izvršavanja je uvek rezultat poslednje linije koda u njoj. Stoga se pisanje ključne reči return često izostavlja:

def square(x)
  x*x
end

Imena, prefiksi i sufiksi
-------------------------

Lokalne promenljive, parametri metoda i nazivi metoda treba da počnu malim slovom ili donjom crtom: event, user_name. Podaci članovi (instance variables) počinju znakom @, na primer @location. Klasne promenljive (class variables, deljene među svim instancama jedne klasa) počinju sa @@, a globalne promenljive sa $. Ruby konvencija je da se koristi donja crta za razdvajanje reči u nazivima promenljivih ili metoda.

Imena klasa, modula i konstanti moraju početi velikim slovom. Po konvenciji reči se u njima razdvajaju velikim slovima, npr. ActiveRecord.

Ruby metode mogu da se završe i znakom jednakosti, upitnikom i uzvičnikom. Metode koje se završavaju znakom jednakosti mogu da se pozivaju sintaksom dodele. Ukoliko objekat o ima metodu x=, onda su sledeće dve linije koda ekvivalentne:

o.x=(1) # Uobičajena sintaksa pozivanja metode
o.x = 1 # Pozivanje metoda kroz dodelu

Upitnika označava predikat - metode koje vraćaju Boolean vrednost. Na primer, klase Array i Hash definišu metodu empty? koja proverava da li struktura sadrži ijedan element. Uzvičnik na kraju naziva metode ukazuje da ona koristi sa opreznošću. Niz klasa iz standardne Ruby biblioteke definiše parove metoda koje se isto zovu, osim što se jedna završava uzvičnikom. Obično se radi o tome da jedna vraća modifikovanu kopiju izvornog objekta, dok druga vrši operaciju nad samim objektom. Tako Array objekti imaju metode sort i sort!. U Railsu je češće razlika u (ne)bacanju izuzetka, npr. save i save!.

Klase i moduli
--------------

Izuzeci
-------
