========================
3. Specifikacija sistema
========================

U ovom poglavlju će biti izloženi i opisani UML dijagrami koji predstavljaju specifikaciju gradmx aplikacije.

3.1 Slučajevi korišćenja
========================

Slika 3.1. - slučajevi korišćenja gradmx aplikacije

Registracija
------------

 * Preduslovi: Korisnik nije prijavljen.
 * Opis: Korisnik prati link za učlanjenje na početnoj stranici aplikacije, popunjava neophodne podatke (korisničko ime, email adresa, grad, država, šifra i potvrda šifre) i postaje registrovani član uz poruku o uspešnosti.
 * Izuzeci: Korisničko ime nije uneto ili je već iskorišćeno; korisničko ime je kraće od 3 ili duže od 40 karaktera; korisničko ime sadrži nedozvoljene karaktere; email adresa nije uneta ili je već iskorišćena; email adresa nije odgovarajućeg formata; grad nije unet; šifra je kraća od 6 ili duža od 40 karaktera; šifra se ne poklapa sa potvrdom. U tom slučaju, korisniku se ponovo prikazuje formular sa prethodnim unosom uz adekvatnu poruku.

Prijava na sistem
-----------------

 * Preduslovi: Korisnik je registrovan i nije prijavljen.
 * Opis: Korisnik prati link za prijavu, unosi svoje korisničko ime i šifru i prijavljuje se uz poruku o uspešnosti. Opciono može da odabere da prijava bude zapamćena na određeno vreme.
 * Izuzeci: Uneti korisničko ime i šifra se ne poklapaju sa podacima u bazi podataka; ne postoji uneto korisničko ime.

Odjava sa sistema
-----------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Korisnik prati link za odjavu i biva odjavljen sa sistema.
 * Izuzeci: Nema.

Prikaz odabranih događaja
-------------------------

 * Preduslovi: Nema.
 * Opis: Početna stranica prikazuje 10 odabranih događaja.
 * Izuzeci: Nema.

Pregled svih događaja
---------------------

 * Preduslovi: Nema.
 * Opis: Korisnik prati link na početnoj stranici i prikazuje mu se spisak svih objavljenih događaja. Događaji su sortirani prema vremenu objave u opadajućem redosledu i podeljeni u stranice. U manjem delu ekrana se nabraja nekoliko odabranih mesta.
 * Izuzeci: Nema.

Prikaz događaja
---------------

 * Preduslovi: Nema.
 * Opis: Stranica događaja sadrži naslov, vreme početka i (ukoliko postoji) završetka, podatak o objavljivaču, mesto i grad dešavanja, opis događaja, spisak korisnika koji mu prisustvuju i spisak svih komentara. Ukoliko je korisnik prijavljen, dozvoljava mu se da prijavi prisustvo i doda svoj komentar na događaj.
 * Izuzeci: Nema.

Objava novog događaja
---------------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Korisniku se prikazuje formular sa sledećim poljima: naslov, mesto, vreme početka, vreme kraja i opis. Svi podaci sem vremena kraja događaja su neophodni. Mesto događaja se bira autocomplete načinom unosa, pri čemu sugerisana lista mesta sadrži naziv mesta i grad. Nakon snimanja, korisniku se prikazuje stranica objavljenog događaja.
 * Izuzeci: Neki od neophodnih podataka nije unet; vreme kraja je pre vremena početka; vreme početka je u prošlosti.

Izmena podataka o događaju
--------------------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Korisnik može da izmeni podatke o svakom objavljenom događaju. Praćenjem linka za izmenu na stranici događaja, prikazuje mu se ista formular kao i u slučaju objave novog, popunjen sa vrednostima koje se trenutno nalaze u bazi podataka
 * Izuzeci: Isti kao i u slučaju objave.

Pregled svih mesta
------------------

 * Preduslovi: Nema.
 * Opis: Sa stranice pregleda svih događaja, korisnik može da odabere prikaz svih objavljenih mesta. Mesta su sortirana po abecednom redosledu i podeljeni u stranice.
 * Izuzeci: Nema.

Prikaz mesta
------------

 * Preduslovi: Nema.
 * Opis: Stranica mesta treba da sadrži naziv, grad i opis mesta, kao i listu svih događaja održanih na njemu, sortiranu u opadajućem redosledu po vremenu dešavanja.
 * Izuzeci: Nema.

Objava novog mesta
------------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Praćenjem linka na stranici prikaza svih mesta, prikazuje se formular sa sledećim poljima: ime, grad, država i opis. Sva polja su neophodna.
 * Izuzeci: Neki od neophodnih podataka nije unet.

Izmena podataka o mestu
-----------------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Praćenjem linka na stranici mesta, prikazuje se formular sa istim poljima kao i prilikom objave, popunjen sa vrednostima koje se trenutno nalaze u bazi podataka.
 * Izuzeci: Isti kao i u slučaju objave.

Prijava prisustva na događaju
-----------------------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Korisnik praćenjem linka na stranici događaja prijavljuje prisustvo. Ime korisnika se potom bez učitavanja stranice dopiše na spisak onih koji su objavili prisustvo bez novog učitavanja stranice (Ajax zahtev).
 * Izuzeci: Nema.

Odjava prisustva na događaju
----------------------------

 * Preduslovi: Korisnik je prijavljen i prethodno prijavio prisustvo.
 * Opis: Korisnik praćenjem linka na stranici događaja odjavljuje prisustvo. Ime korisnika se potom bez učitavanja stranice briše sa spiska onih koji su objavili prisustvo bez novog učitavanja stranice (Ajax zahtev).
 * Izuzeci: Nema.

Pisanje komentara
-----------------

 * Preduslovi: Korisnik je prijavljen.
 * Opis: Na stranici događaja korisnik može da napiše i objavi svoj komentar. Novi komentar se dodaje bez ponovnog učitavanja stranice, Ajax zahtevom. Komentari su izlistani u opadajućem redosledu prema vremenu objave.
 * Izuzeci: Objava komentara bez teksta ne rezultuje zahtevom ka serveru.

Promena jezika
--------------

 * Preduslovi: Nema.
 * Opis: Praćenjem jednog od odgovarajućih linkova korisnički interfejs se u svakom narednom zahtevu prikazuje na odabranom jeziku, srpskom ili engleskom.
 * Izuzeci: Nema.

3.2 Dijagrami klasa
===================

U nastavku su prikazani dijagrami klasa modela gradmx aplikacije, a dato je i kraće objašnjenje njihovih uloga.

Slika 3.2. - Klase ActiveRecord modela

Slika 3.3. - Klase modela koje se oslanjaju na Tokyo Cabinet biblioteku

Klasa User opisuje registrovanog korisnika gradmx aplikacije. Ona se u velikoj meri oslanja na restful-authentication plugin, koji pruža pomoćni kod za registraciju i autentifikaciju, rukovanje šifrom, upravljanje sesijom i cookie-em.

Klase Event i Location opisuju događaje i mesta. Svaki događaj je vezan za jedno mesto, može imati više komentara (opisanih klasom Comment) i prisustva (opisanih klasom Presence).

I korisnik i mesto pripadaju jednom gradu, opisanom klasom City. Ona sadrži logiku koja garantuje nepostojanje duplikata na osnovu korisnikovog unosa.

TokyoRecord je objektno relacioni omotač oko Tokyo Cabinet tabela kojima se pristupa preko Tokyo Tyrant servera, i pruža osnovni API koji liči na ActiveRecord. Pomoću njega su izvedeni modeli Highlights, PageView i Presence.

Highlights sadrži veze ka odabranim događajima koji se promovišu na početnoj stranici aplikacije.

PageView opisuje pregled jedne stranice gradmx aplikacije. Može da predstavlja kako anonimne tako i preglede prijavljenih korisnika, a ima mogućnost snimanja vrednosti ključa ka pregledanom događaju ili mestu, zbog posebne važnosti tih stranica.

Presence opisuje prisustvo registrovanog korisnika na nekom događaju.
